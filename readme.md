# Sop 聚合聊天


### 功能描述


#### 1. 企业微信账号列表
- 根据父窗口折叠
- 显示用户图标、名称、组织和类型(云机托管)
- 鼠标点击单选用户，未选中表示选择全部用户


#### 2. 聊天客户列表
- header 部分包括`开启接待`和`开启机器人` 
- 包括 `处理中`、`群聊`和`客户`这三个tab类型
- 点击 tab 切换不同的数据类型，具体显示数据要求见下
- 鼠标右键出现菜单，选择`置顶`或 `取消置顶` 可以设置当前对象是否排列到顶部
- 列表数据的排序顺序是：1）是否置顶 2）回复时间
- 输入搜索关键字，按回车后可以显示结果，按 backspace 键清空关键字可以还原列表
- 鼠标左键点击选择高亮，并且显示聊天内容


```bash
# 处理中
-------   用户名      时间
| 用户 |
| 图标 |   聊天内容
-------

# 群聊
-------   用户名      群类型 群主
| 群聊 |
| 图标 |  
-------

# 处理中
-------   用户名      聊天类型 时间
| 用户 |
| 图标 |   聊天内容
-------
```



#### 3. 聊天内容列表
1. 根据聊天记录进行列表渲染，支持 `文本`、`音频`、`视频`、`小程序`、`文件`、`图片`、`动画`等
2. 聊天界面分为：`信息头`、`信息列表`和`发送框`  三个部分
3. 聊天记录上面显示`更多聊天记录`按钮,可以显示历史聊天记录
4. 

```bash
# 信息头
信息头部分主要用于对象基本信息的显示
--------------------------------------
|用户名 信息来源  类型             虚拟群|
--------------------------------------


# 信息列表
信息头部分主要用于对象基本信息的显示
--------------------------------------
|                                    |
|头像　用户名　发送时间                  |
|图标                                 |
|                                    |
|                 用户名　发送时间　 头像|
|                              　 图标|
|                                    |
--------------------------------------
```





#### 4. 实时消息
1. 聊天消息 `ReceiveChatMessage`: 处理接受到的聊天消息 `转交`
2. 更新外部用户 `UpdateExternalUsers`：更新用户状态 `流失` 
3. 更新群聊消息 `UpdateRoomMsg`：更新群聊消息
4. 添加外部用户 `NewExternalUsers`：将新用户添加到列表，判断是否置顶排序

```bash
# ReceiveChatMessage
1. 退出登录
2. 异常退出企微账号
3. 企微账号登录或者新的联系人
4. 转交通知消息
5. 创建群
6. 添加群成员
7. 删除群成员
8. 图文链接消息
9. 小程序消息
10.其他消息
11.不支持消息
12.角标处理
```


#### 5. 疑问逻辑
1. 关闭机器人
2. NewExternalUsers是把用户添加到哪个列表？
3. ReceiveChatMessage的 `主动退出` `心跳`
4. 角标处理的计算逻辑
5. 













